---
phase: 04-ci-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [.github/workflows/ci.yml]
autonomous: false

must_haves:
  truths:
    - 'Pushing code to any branch triggers CI validation'
    - 'CI runs ESLint on both frontend and backend'
    - 'CI runs TypeScript type-check on both packages'
    - 'CI fails with clear error messages when lint or type errors exist'
    - 'CI passes when code has no lint or type errors'
  artifacts:
    - path: '.github/workflows/ci.yml'
      provides: 'GitHub Actions workflow with lint and typecheck jobs'
      min_lines: 50
      contains: 'on: [push, pull_request]'
    - path: '.github/workflows/ci.yml'
      provides: 'Lint job that runs npm run lint'
      contains: 'npm run lint'
    - path: '.github/workflows/ci.yml'
      provides: 'Type-check job that validates both packages'
      contains: 'tsc --noEmit'
  key_links:
    - from: 'GitHub push/PR event'
      to: '.github/workflows/ci.yml'
      via: 'GitHub Actions trigger'
      pattern: 'on:.*push.*pull_request'
    - from: 'ci.yml lint job'
      to: 'eslint.config.js'
      via: 'npm run lint command'
      pattern: 'npm run lint'
    - from: 'ci.yml typecheck job'
      to: 'tsconfig.json files'
      via: 'tsc --noEmit and npm run build'
      pattern: '(tsc --noEmit|npm run build)'
---

<objective>
Create GitHub Actions CI workflow that automatically validates code quality (ESLint) and type safety (TypeScript) on every push and pull request.

Purpose: Prevent broken code from being merged by catching lint and type errors early in the development cycle. Provides fast feedback to developers without manual intervention.

Output: Working CI pipeline with separate lint and type-check jobs running in parallel
</objective>

<execution_context>
@/home/mvrdu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/mvrdu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-ci-pipeline/04-RESEARCH.md

# Prior phase context - ESLint and Prettier setup

@.planning/phases/01-eslint/01-01-SUMMARY.md
@.planning/phases/02-prettier-integration/02-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions CI workflow with lint and type-check jobs</name>
  <files>.github/workflows/ci.yml</files>
  <action>
Create `.github/workflows/ci.yml` with two parallel jobs (lint and typecheck) that run on push and pull_request events.

**Workflow structure:**

- Name: "CI"
- Triggers: push to main/master branches, all pull requests
- Permissions: contents: read (for checkout)
- Node.js version: 20.x (matches project's Node.js v20.20.0)
- Dependency caching: Use `cache: 'npm'` in setup-node for fast CI runs

**Job 1: ESLint**

- Name: "ESLint"
- Runner: ubuntu-latest
- Steps:
  1. Checkout code (actions/checkout@v4)
  2. Setup Node.js 20.x with npm caching (actions/setup-node@v4)
  3. Install root dependencies (`npm ci`)
  4. Install API dependencies (`npm ci --prefix api`)
  5. Run ESLint on all files (`npm run lint`)

**Job 2: TypeScript Type-Check**

- Name: "TypeScript Type-Check"
- Runner: ubuntu-latest
- Steps:
  1. Checkout code (actions/checkout@v4)
  2. Setup Node.js 20.x with npm caching (actions/setup-node@v4)
  3. Install root dependencies (`npm ci`)
  4. Install API dependencies (`npm ci --prefix api`)
  5. Type-check frontend (`npx tsc --noEmit`)
  6. Type-check backend (`npm run build --workspace=api`)

**Why these commands:**

- `npm ci` (not `npm install`): CI-specific command that's faster, deterministic, and fails if lockfile is out of sync
- `npm ci --prefix api`: Backend has separate package.json and node_modules
- `npx tsc --noEmit`: Frontend type-check without build output (Vite handles building)
- `npm run build --workspace=api`: Backend build doubles as type-check (tsc validates types during compilation)

**Why separate jobs:**

- Parallel execution (faster feedback)
- Clear failure attribution (know if it's a lint issue vs type error)
- GitHub Actions shows each job status independently

Use the complete workflow template from 04-RESEARCH.md (lines 205-266) as the reference implementation.
</action>
<verify>

1. Check file exists: `ls -la .github/workflows/ci.yml`
2. Validate workflow syntax: `cat .github/workflows/ci.yml | grep -E "(name: CI|on:.*push|jobs:|lint:|typecheck:)"`
3. Verify Node.js version: `grep "node-version: '20.x'" .github/workflows/ci.yml`
4. Verify caching enabled: `grep "cache: 'npm'" .github/workflows/ci.yml`
5. Verify both packages installed: `grep -c "npm ci" .github/workflows/ci.yml` should return 4 (2 per job)
6. Verify lint command: `grep "npm run lint" .github/workflows/ci.yml`
7. Verify type-check commands: `grep -E "(tsc --noEmit|npm run build --workspace=api)" .github/workflows/ci.yml`
   </verify>
   <done>

- `.github/workflows/ci.yml` exists with 50+ lines
- Workflow has 2 jobs (lint, typecheck) configured to run in parallel
- Both jobs use Node.js 20.x with npm caching
- Both jobs install dependencies for root and api packages
- Lint job runs `npm run lint`
- Type-check job runs `npx tsc --noEmit` and `npm run build --workspace=api`
- Workflow triggers on push to main/master and all pull requests
  </done>
  </task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
GitHub Actions CI workflow with automated lint and type-check validation on every push/PR. The workflow consists of two parallel jobs:
1. ESLint job - validates code quality using existing eslint.config.js
2. TypeScript job - validates type safety for both frontend and backend

The workflow uses npm dependency caching for fast CI runs and fails when lint errors or type errors are detected.
</what-built>
<how-to-verify>
**Step 1: Commit and push the workflow**

```bash
git add .github/workflows/ci.yml
git commit -m "ci(04): add GitHub Actions CI workflow for lint and type-check"
git push origin $(git branch --show-current)
```

**Step 2: Verify workflow appears in GitHub**

1. Navigate to: https://github.com/veniciosribeiro/masterclass-carreira-tech/actions
2. You should see the CI workflow listed in the left sidebar
3. Click on the most recent workflow run (should be the commit you just pushed)

**Step 3: Verify both jobs run successfully**
Expected behavior:

- ✅ ESLint job completes with green checkmark (all lint checks pass)
- ✅ TypeScript Type-Check job completes with green checkmark (no type errors)
- Both jobs should complete in under 2 minutes (first run) or under 1 minute (subsequent runs with cache)

**Step 4: Check job details**
Click into each job and verify:

- ESLint job shows "Run ESLint on all files" step with no errors
- TypeScript job shows both type-check steps completing successfully
- Look for "Cache restored" messages confirming dependency caching is working

**Step 5: Test failure detection (optional but recommended)**
Create a test commit with an intentional error to verify CI catches it:

```bash
# Add intentional lint error (remove semicolon)
echo "const test = 'no semicolon'" >> test-error.ts
git add test-error.ts
git commit -m "test: verify CI catches errors"
git push
```

Expected: CI should fail with red X, ESLint job shows the missing semicolon error

Clean up:

```bash
git reset --hard HEAD~1
git push --force
rm test-error.ts
```

**What to look for:**
✅ Workflow file committed and pushed without errors
✅ GitHub Actions page shows the CI workflow
✅ Both jobs (ESLint, TypeScript) complete successfully
✅ Job logs show all steps passing
✅ Cache is working (see "Cache restored" in logs)
✅ Total run time is reasonable (< 2 min first run, < 1 min cached)

**Common issues:**

- If jobs don't start: Check GitHub Actions is enabled for the repo (Settings → Actions → Allow all actions)
- If checkout fails: Permissions might be needed - check workflow has `permissions: contents: read`
- If npm ci fails: Package-lock files might be out of sync - run `npm install` locally and commit
- If cache doesn't work: First run creates cache, second run should restore it
  </how-to-verify>
  <resume-signal>
  Type one of:
- "approved" - CI workflow running successfully
- "failed: [description]" - Describe what's not working so I can fix it
- "question: [question]" - Ask for clarification
  </resume-signal>
  </task>

</tasks>

<verification>
After completing all tasks, verify Phase 4 goals are met:

1. **CI-01: Pipeline runs lint on every push/PR**
   - Verify: Check `.github/workflows/ci.yml` has `on: [push, pull_request]` trigger
   - Verify: Lint job contains `npm run lint` command
   - Test: Push a commit and confirm workflow runs automatically

2. **CI-02: Pipeline runs type-check on both packages**
   - Verify: Check type-check job has `tsc --noEmit` for frontend
   - Verify: Check type-check job has `npm run build --workspace=api` for backend
   - Test: Workflow logs show both type-check steps completing

3. **CI-03: Pipeline fails and reports errors clearly**
   - Test: Introduce intentional lint error, verify job fails with error message
   - Test: Introduce intentional type error, verify job fails with error message
   - Verify: GitHub shows clear red X on failed workflows with error details

**Success indicators:**

- Green checkmarks on all commits in GitHub
- CI badge shows "passing" status (can be added to README later)
- Developers get automated feedback within 1-2 minutes of pushing
- No manual intervention needed for validation
  </verification>

<success_criteria>
**Phase 4 is complete when:**

1. ✅ `.github/workflows/ci.yml` exists and is committed to repository
2. ✅ Workflow triggers automatically on push and pull_request events
3. ✅ ESLint job validates code quality using `npm run lint`
4. ✅ TypeScript job validates type safety for both frontend and backend
5. ✅ Both jobs run in parallel for fast feedback
6. ✅ CI uses dependency caching for performance (< 1 min on cached runs)
7. ✅ CI fails with clear error messages when lint or type errors exist
8. ✅ CI passes when codebase has no lint or type errors
9. ✅ All three CI requirements (CI-01, CI-02, CI-03) are satisfied
10. ✅ Developer workflow is: push code → CI validates automatically → merge if green

**Measurable outcomes:**

- Workflow run time: < 2 minutes first run, < 1 minute with cache
- All jobs show green checkmarks on clean codebase
- Intentional errors cause workflow to fail with visible error messages
- GitHub Actions page shows workflow history with pass/fail status
  </success_criteria>

<output>
After completion, create `.planning/phases/04-ci-pipeline/04-01-SUMMARY.md` using the summary template.

Include in summary:

- Workflow configuration details (trigger events, jobs, steps)
- Performance metrics (first run time, cached run time)
- Integration with existing lint and type-check infrastructure
- Testing results (successful runs, failure detection)
  </output>
