---
phase: 02-prettier-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - api/package.json
  - .prettierrc
  - .prettierignore
  - eslint.config.js
  - package-lock.json
  - api/package-lock.json
  - (all .ts, .tsx, .js, .json files - formatting)
autonomous: true

must_haves:
  truths:
    - 'Running Prettier formats files according to project conventions'
    - 'ESLint and Prettier never disagree on the same file'
    - '`npm run format` script works from root directory'
    - '`npm run format` script works from api/ directory'
    - '`npm run lint` after formatting shows no style-related errors'
  artifacts:
    - path: '.prettierrc'
      provides: 'Prettier configuration matching existing conventions'
      contains: 'semi.*true|singleQuote.*true|tabWidth.*2'
    - path: '.prettierignore'
      provides: 'Exclusion list for generated files'
      min_lines: 10
    - path: 'eslint.config.js'
      provides: 'ESLint config with Prettier integration'
      contains: 'eslint-config-prettier'
    - path: 'package.json'
      provides: 'Format scripts for root package'
      exports: ['format', 'format:check']
    - path: 'api/package.json'
      provides: 'Format scripts for backend package'
      exports: ['format', 'format:check']
  key_links:
    - from: 'eslint.config.js'
      to: 'eslint-config-prettier'
      via: 'import and include in config array'
      pattern: 'import.*eslint-config-prettier|prettierConfig'
    - from: 'package.json scripts'
      to: 'prettier CLI'
      via: 'npm run format executes prettier --write'
      pattern: 'prettier.*--write'
---

<objective>
Install and configure Prettier with ESLint integration to enable consistent automatic code formatting across the monorepo.

Purpose: Eliminate manual formatting decisions and prevent style-related ESLint errors by delegating all formatting to Prettier while ensuring ESLint and Prettier rules never conflict.

Output: Prettier configured and integrated, entire codebase formatted, format scripts available in both packages, zero ESLint-Prettier conflicts.
</objective>

<execution_context>
@/home/mvrdu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/mvrdu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-prettier-integration/02-RESEARCH.md
@.planning/phases/01-eslint/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Prettier, create config files, and integrate with ESLint</name>
  <files>
    package.json
    api/package.json
    package-lock.json
    api/package-lock.json
    .prettierrc
    .prettierignore
    eslint.config.js
  </files>
  <action>
    **Install Prettier and eslint-config-prettier in both packages with exact version pinning:**
    
    ```bash
    npm install --save-dev --save-exact prettier eslint-config-prettier
    cd api && npm install --save-dev --save-exact prettier eslint-config-prettier && cd ..
    ```
    
    Use `--save-exact` to pin exact versions and prevent formatting drift across environments.
    
    **Create .prettierrc at project root with existing conventions:**
    
    ```json
    {
      "semi": true,
      "singleQuote": true,
      "tabWidth": 2,
      "trailingComma": "es5",
      "arrowParens": "always",
      "printWidth": 80,
      "endOfLine": "lf"
    }
    ```
    
    These match the project's existing code style (semicolons, single quotes, 2 spaces, trailing commas in objects/arrays, always parenthesize arrow params).
    
    **Create .prettierignore at project root:**
    
    ```
    # Dependencies
    node_modules/
    api/node_modules/
    
    # Build outputs
    dist/
    build/
    coverage/
    
    # Package files
    package-lock.json
    api/package-lock.json
    yarn.lock
    pnpm-lock.yaml
    
    # Prisma (auto-generated)
    api/prisma/migrations/
    
    # Git
    .git/
    ```
    
    This excludes generated files and dependencies from formatting.
    
    **Update eslint.config.js to include eslint-config-prettier:**
    
    Import at the top:
    ```js
    import prettierConfig from 'eslint-config-prettier';
    ```
    
    Add to the end of the exported array (MUST be last to override previous configs):
    ```js
    export default [
      // ... existing configs (js.configs.recommended, etc.) ...
      prettierConfig, // ADD THIS LAST
    ];
    ```
    
    **Add format scripts to root package.json:**
    
    ```json
    {
      "scripts": {
        "format": "prettier --write .",
        "format:check": "prettier --check .",
        "format:frontend": "prettier --write --ignore-pattern 'api/**' .",
        "format:backend": "prettier --write api/"
      }
    }
    ```
    
    **Add format scripts to api/package.json:**
    
    ```json
    {
      "scripts": {
        "format": "prettier --write .",
        "format:check": "prettier --check ."
      }
    }
    ```
  </action>
  <verify>
    ```bash
    # Verify Prettier installed in both packages
    npm list prettier eslint-config-prettier
    cd api && npm list prettier eslint-config-prettier && cd ..
    
    # Verify config files exist
    test -f .prettierrc && echo ".prettierrc exists"
    test -f .prettierignore && echo ".prettierignore exists"
    
    # Verify eslint.config.js imports prettier config
    grep -q "eslint-config-prettier" eslint.config.js && echo "ESLint integration added"
    
    # Verify format scripts exist
    npm run format:check --version 2>/dev/null || npm run format -- --version
    cd api && npm run format -- --version && cd ..
    ```
  </verify>
  <done>
    - `prettier` and `eslint-config-prettier` installed in both packages with exact versions
    - `.prettierrc` exists at root with correct options (semi: true, singleQuote: true, tabWidth: 2, trailingComma: es5, arrowParens: always)
    - `.prettierignore` exists and excludes node_modules, dist, package-lock files, prisma migrations
    - `eslint.config.js` imports and includes `prettierConfig` at the end of config array
    - `package.json` has format, format:check, format:frontend, format:backend scripts
    - `api/package.json` has format and format:check scripts
  </done>
</task>

<task type="auto">
  <name>Task 2: Format entire codebase with Prettier</name>
  <files>
    (all .ts, .tsx, .js, .json files in project)
  </files>
  <action>
    Run Prettier on the entire codebase to apply consistent formatting:
    
    ```bash
    npm run format
    ```
    
    This will format all TypeScript, JavaScript, and JSON files according to the configuration in `.prettierrc`. Files listed in `.prettierignore` will be skipped.
    
    **Expected changes:**
    - Semicolons added/removed to match `semi: true`
    - Quotes standardized to single quotes (except where escaping required)
    - Indentation normalized to 2 spaces
    - Trailing commas added to objects and arrays (ES5 valid locations)
    - Arrow function params parenthesized
    - Long lines wrapped at 80 characters
    - Consistent spacing around operators and keywords
    
    **Note:** This is a formatting-only change. No functional changes to code. All changes should be superficial style adjustments.
  </action>
  <verify>
    ```bash
    # Verify all files are formatted (should pass with no changes needed)
    npm run format:check
    ```
    
    Exit code should be 0 (all files formatted). If non-zero, some files still need formatting.
  </verify>
  <done>
    - Running `npm run format:check` exits with code 0 (all files formatted)
    - Git diff shows only formatting changes (quotes, semicolons, indentation, trailing commas)
    - No functional changes to code logic
  </done>
</task>

<task type="auto">
  <name>Task 3: Verify ESLint and Prettier integration</name>
  <files>
    (verification only - no files modified)
  </files>
  <action>
    Verify that ESLint and Prettier do not have conflicting rules:
    
    ```bash
    # Use eslint-config-prettier CLI helper to check for conflicts
    npx eslint-config-prettier eslint.config.js
    ```
    
    This tool checks the ESLint configuration and reports any rules that conflict with Prettier.
    
    Then verify linting works without style errors:
    
    ```bash
    npm run lint
    ```
    
    After formatting, there should be no style-related ESLint errors (like `quotes`, `semi`, `indent`, `comma-dangle`, etc.). Only logical errors (if any) should remain.
    
    Also test format scripts from both locations:
    
    ```bash
    # Test root scripts
    npm run format:check
    
    # Test api scripts
    cd api && npm run format:check && cd ..
    ```
  </action>
  <verify>
    ```bash
    # 1. Check for ESLint-Prettier conflicts
    npx eslint-config-prettier eslint.config.js
    
    # 2. Run lint (should have no style errors after formatting)
    npm run lint 2>&1 | tee lint-output.txt
    
    # 3. Verify no style-related errors in output
    ! grep -E "(quotes|semi|indent|comma-dangle|arrow-parens)" lint-output.txt
    
    # 4. Test format:check from root
    npm run format:check
    
    # 5. Test format:check from api
    cd api && npm run format:check && cd ..
    ```
  </verify>
  <done>
    - `npx eslint-config-prettier eslint.config.js` reports "No rules that are unnecessary or conflict with Prettier were found"
    - `npm run lint` shows zero style-related errors (quotes, semi, indent, etc.)
    - `npm run format:check` passes from root directory
    - `cd api && npm run format:check` passes from api directory
    - Requirements DX-03, DX-04, DX-07 satisfied
  </done>
</task>

</tasks>

<verification>
After all tasks complete, verify phase success:

1. **Format scripts functional:**

   ```bash
   npm run format:check  # Should pass
   cd api && npm run format:check  # Should pass
   ```

2. **ESLint integration verified:**

   ```bash
   npx eslint-config-prettier eslint.config.js  # No conflicts
   npm run lint  # No style errors
   ```

3. **Requirements coverage:**
   - DX-03: Prettier configured ✓
   - DX-04: ESLint and Prettier integrated without conflicts ✓
   - DX-07: Scripts `lint` and `format` work from root and api/ ✓

4. **Success criteria from ROADMAP:**
   - Running Prettier formats files according to conventions ✓
   - ESLint and Prettier never disagree ✓
   - npm scripts work from both directories ✓
     </verification>

<success_criteria>
**Phase complete when:**

- All files in codebase are formatted by Prettier
- Running `npm run format:check` exits successfully from root and api/
- Running `npm run lint` shows no style-related errors
- eslint-config-prettier CLI helper reports zero conflicts
- Format scripts (`npm run format`, `npm run format:check`) exist and work in both packages
  </success_criteria>

<output>
After completion, create `.planning/phases/02-prettier-integration/02-01-SUMMARY.md` following the standard summary template.
</output>
