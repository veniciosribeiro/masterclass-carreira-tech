---
phase: 01-eslint
plan: 03
type: execute
wave: 1
depends_on: []
files_modified: [eslint.config.js]
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Developer can run npm run lint from root directory"
    - "Developer can run npm run lint from api/ directory"
  artifacts:
    - path: "eslint.config.js"
      provides: "ESLint config with CWD-independent tsconfig path"
      min_lines: 150
  key_links:
    - from: "eslint.config.js"
      to: "api/tsconfig.json"
      via: "parserOptions.project with absolute path"
      pattern: "project:.*api/tsconfig\\.json"
---

<objective>
Fix ESLint backend config to use CWD-independent path resolution, enabling `npm run lint` to work from both root and api/ directories.

Purpose: Close verification gap — must-have truth "Developer can run npm run lint from root or api/ directory" is currently only partially satisfied (works from root, fails from api/).

Output: Updated eslint.config.js with absolute path resolution for backend tsconfig.
</objective>

<execution_context>
@/home/mvrdu/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/mvrdu/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-eslint/01-01-SUMMARY.md
@.planning/phases/01-eslint/01-02-SUMMARY.md
@.planning/phases/01-eslint/01-VERIFICATION.md
@eslint.config.js
@api/package.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix backend tsconfig path to use absolute resolution</name>
  <files>eslint.config.js</files>
  <action>
Update the backend configuration block (starting ~line 103) to use an absolute path for `parserOptions.project` and `settings['import/resolver'].typescript.project`.

**Current issue (from VERIFICATION.md):**
- Line 111: `project: './api/tsconfig.json'` is relative
- When running from `api/` directory, this resolves to `api/api/tsconfig.json` (double-api)
- Causes parser error: "Cannot read file 'api/api/tsconfig.json'"

**Fix approach:**
Use `import.meta.url` to compute absolute path independent of CWD:

```js
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// In backend config object (~line 111 and ~line 127):
project: join(__dirname, 'api/tsconfig.json'),
```

**Alternative (if import.meta.url causes issues):**
Use `process.cwd()` with path.join to resolve from project root (ESLint always runs config from root dir, so CWD is predictable):

```js
import { join } from 'path';

// In backend config:
project: join(process.cwd(), 'api/tsconfig.json'),
```

**Why this matters:** The plan explicitly required this capability (01-02-PLAN Task 3 verification line 221: "Running `npm run lint` from api/ executes eslint on backend files"), and the must-have truth requires lint to work from both directories.

**Implementation:**
1. Add path/url imports at top of eslint.config.js
2. Compute __dirname (if using import.meta.url approach) 
3. Update line 111: `project: join(__dirname, 'api/tsconfig.json')`
4. Update line 127 (inside settings.import/resolver.typescript): `project: join(__dirname, 'api/tsconfig.json')`
5. Preserve all other config options unchanged
  </action>
  <verify>
Run from both directories and confirm zero errors:

```bash
# From root (should still work)
npm run lint

# From api (currently fails, should now work)
cd api && npm run lint

# Verify backend files are actually being linted
echo "const unused = 'test';" >> api/src/test-lint.ts
npm run lint 2>&1 | grep "unused"
rm api/src/test-lint.ts
```

Expected: All three checks pass — root lint succeeds, api lint succeeds, unused variable is caught.
  </verify>
  <done>
- `eslint.config.js` backend config uses absolute path for tsconfig project
- Running `npm run lint` from root directory exits with code 0
- Running `npm run lint` from api/ directory exits with code 0
- ESLint still catches real violations (unused variables) in backend code
  </done>
</task>

</tasks>

<verification>
**From VERIFICATION.md Gap:**

The must-have truth "Developer can run npm run lint from root or api/ directory" must now be fully verified (currently "partial" status).

**Tests:**
1. Run `npm run lint` from root → should pass (already works)
2. Run `cd api && npm run lint` → should pass (currently fails)
3. Create intentional violation in backend, verify ESLint catches it from both dirs

**Success indicator:** Both execution contexts return exit code 0 for clean code, non-zero for violations.
</verification>

<success_criteria>
- Backend ESLint config uses CWD-independent absolute path resolution
- `npm run lint` succeeds from project root (regression test)
- `npm run lint` succeeds from api/ directory (gap closure)
- ESLint parser can locate api/tsconfig.json from both execution contexts
- Verification gap closed: truth #3 status changes from "partial" to "verified"
</success_criteria>

<output>
After completion, create `.planning/phases/01-eslint/01-03-SUMMARY.md` documenting:
- Path resolution approach used (import.meta.url vs process.cwd())
- Verification results from both directories
- Any edge cases discovered
</output>
